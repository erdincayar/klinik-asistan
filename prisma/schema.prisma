generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id                  String               @id @default(cuid())
  email               String               @unique
  password            String
  name                String
  clinicId            String?
  clinic              Clinic?              @relation(fields: [clinicId], references: [id])
  onboardingCompleted Boolean              @default(false)
  passwordResetTokens PasswordResetToken[]
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
}

model PasswordResetToken {
  id        String    @id @default(cuid())
  token     String    @unique
  userId    String
  user      User      @relation(fields: [userId], references: [id])
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime  @default(now())
}

// Plan values: BASIC, PRO
// Sector values: SAGLIK, RESTORAN, OTEL, KUAFOR, GUZELLIK, DIGER
// MessagingPreference values: WHATSAPP, TELEGRAM, BOTH
model Clinic {
  id                  String           @id @default(cuid())
  name                String
  phone               String?
  address             String?
  taxRate             Int              @default(20)
  sector              String?
  plan                String?          // BASIC, PRO
  selectedModules     String?          // JSON array string
  messagingPreference String?          // WHATSAPP, TELEGRAM, BOTH
  users               User[]
  patients            Patient[]
  treatments          Treatment[]
  expenses            Expense[]
  reminders           Reminder[]
  appointments        Appointment[]
  clinicSchedules      ClinicSchedule[]
  patientPreferences   PatientPreference[]
  patientVisitPatterns PatientVisitPattern[]
  reminderLogs         ReminderLog[]
  employees            Employee[]
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt
}

model Patient {
  id           String        @id @default(cuid())
  name         String
  phone        String?
  email        String?
  notes        String?
  clinicId     String
  clinic       Clinic        @relation(fields: [clinicId], references: [id])
  treatments   Treatment[]
  appointments Appointment[]
  preferences      PatientPreference[]
  visitPattern     PatientVisitPattern?
  reminderLogs     ReminderLog[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

// TreatmentCategory values: BOTOX, DOLGU, DIS_TEDAVI, GENEL
// SQLite doesn't support enums, using String instead

model Treatment {
  id          String   @id @default(cuid())
  patientId   String
  patient     Patient  @relation(fields: [patientId], references: [id])
  clinicId    String
  clinic      Clinic   @relation(fields: [clinicId], references: [id])
  name        String
  description String?
  amount      Int      // kuruş cinsinden
  date        DateTime @default(now())
  category    String   @default("GENEL") // BOTOX, DOLGU, DIS_TEDAVI, GENEL
  employeeId  String?
  employee    Employee? @relation(fields: [employeeId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Expense {
  id          String   @id @default(cuid())
  clinicId    String
  clinic      Clinic   @relation(fields: [clinicId], references: [id])
  description String
  amount      Int      // kuruş cinsinden
  category    String
  date        DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Reminder {
  id                String   @id @default(cuid())
  treatmentCategory String   // BOTOX, DOLGU, DIS_TEDAVI, GENEL
  intervalDays      Int      @default(180)
  messageTemplate   String
  isActive          Boolean  @default(true)
  clinicId          String
  clinic            Clinic   @relation(fields: [clinicId], references: [id])
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

// Appointment status values: SCHEDULED, COMPLETED, CANCELLED, NO_SHOW
model Appointment {
  id            String   @id @default(cuid())
  patientId     String
  patient       Patient  @relation(fields: [patientId], references: [id])
  clinicId      String
  clinic        Clinic   @relation(fields: [clinicId], references: [id])
  date          DateTime // sadece tarih (gün)
  startTime     String   // "09:00" formatında
  endTime       String   // "09:30" formatında
  status        String   @default("SCHEDULED") // SCHEDULED, COMPLETED, CANCELLED, NO_SHOW
  treatmentType String   @default("GENEL") // BOTOX, DOLGU, DIS_TEDAVI, GENEL
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model ClinicSchedule {
  id           String  @id @default(cuid())
  clinicId     String
  clinic       Clinic  @relation(fields: [clinicId], references: [id])
  dayOfWeek    Int     // 0=Pazar, 1=Pazartesi, ..., 6=Cumartesi
  startTime    String  @default("09:00")
  endTime      String  @default("18:00")
  slotDuration Int     @default(30) // dakika
  isActive     Boolean @default(true)
}

// PatientPreference type values: INDIRIM_SEVER, HEDIYE_SEVER, ARKADASIYLA_GELIR, SADIK_MUSTERI, FIYAT_HASSAS
model PatientPreference {
  id         String   @id @default(cuid())
  patientId  String
  patient    Patient  @relation(fields: [patientId], references: [id])
  clinicId   String
  clinic     Clinic   @relation(fields: [clinicId], references: [id])
  type       String   // INDIRIM_SEVER, HEDIYE_SEVER, ARKADASIYLA_GELIR, SADIK_MUSTERI, FIYAT_HASSAS
  notes      String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

// PatientVisitPattern lastCategory values: BOTOX, DOLGU, DIS_TEDAVI, GENEL
model PatientVisitPattern {
  id               String    @id @default(cuid())
  patientId        String    @unique
  patient          Patient   @relation(fields: [patientId], references: [id])
  clinicId         String
  clinic           Clinic    @relation(fields: [clinicId], references: [id])
  averageVisitDays Int?      // Average days between visits
  lastVisitDate    DateTime?
  totalVisits      Int       @default(0)
  lastCategory     String?   // Last treatment category
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
}

// ReminderLog channel values: WHATSAPP, TELEGRAM, SMS
// ReminderLog status values: PENDING, SENT, FAILED
model ReminderLog {
  id              String    @id @default(cuid())
  patientId       String
  patient         Patient   @relation(fields: [patientId], references: [id])
  clinicId        String
  clinic          Clinic    @relation(fields: [clinicId], references: [id])
  messageContent  String
  channel         String    @default("WHATSAPP") // WHATSAPP, TELEGRAM, SMS
  status          String    @default("PENDING")  // PENDING, SENT, FAILED
  sentAt          DateTime?
  createdAt       DateTime  @default(now())
}

// Employee role values: DOKTOR, ASISTAN, SEKRETER, TEKNISYEN, DIGER
model Employee {
  id             String      @id @default(cuid())
  name           String
  role           String      @default("ASISTAN") // DOKTOR, ASISTAN, SEKRETER, TEKNISYEN, DIGER
  phone          String?
  email          String?
  commissionRate Int         @default(0) // yüzde cinsinden (ör: 10 = %10)
  isActive       Boolean     @default(true)
  clinicId       String
  clinic         Clinic      @relation(fields: [clinicId], references: [id])
  treatments     Treatment[]
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
}
